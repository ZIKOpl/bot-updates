<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard â€” Bot Updates</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <nav class="nav">
    <div class="brand">
      <div class="logo"></div>
      <strong>Bot Updates</strong>
    </div>
    <div class="actions">
      <a href="/" class="btn ghost">Accueil</a>
      <a href="/logout" class="btn danger">DÃ©connexion</a>
    </div>
  </nav>

  <main class="container">
    <section class="hero">
      <h1>ğŸ“ Tableau de bord</h1>
      <p>ConnectÃ© en tant que <b><%= user.username %>#<%= user.discriminator %></b></p>
      <div class="version-pill">DerniÃ¨re version : <%= latest %></div>
    </section>

    <div class="grid">
      <div class="card">
        <h2>ğŸ“¤ Publier une mise Ã  jour</h2>
        <form id="uploadForm" class="upload-form" method="POST" action="/upload" enctype="multipart/form-data">
          <input type="text" name="version" id="versionInput" placeholder="Ex: v2.3" required />

          <div id="dropZone" class="drop-zone">
            <p id="uploadText">Glisse ton fichier .zip ici ou clique pour le choisir</p>
            <input type="file" name="zip" id="fileInput" accept=".zip" hidden />
          </div>

          <button class="btn primary" type="submit">ğŸ“¦ Publier</button>
        </form>
      </div>

      <div class="card">
        <h2>ğŸ“Š Statistiques globales</h2>
        <p>Total de bots : <%= totalBots %></p>
        <p>Ã€ jour : <%= upToDate %></p>
        <p>ObsolÃ¨tes : <%= outdated %></p>
      </div>

      <div class="card">
        <h2>ğŸ“œ Historique des versions</h2>
        <% if (releases.length) { %>
          <div class="release-list">
            <% releases.forEach(r => { %>
              <div class="release-item">
                <span><b><%= r.version %></b></span>
                <span><%= new Date(r.createdAt).toLocaleString("fr-FR") %></span>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <p class="empty">Aucune version publiÃ©e pour le moment.</p>
        <% } %>
      </div>
    </div>
  </main>

  <footer class="footer">Â© 2025 â€” Bot Updates Panel</footer>

  <script>
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");
    const uploadText = document.getElementById("uploadText");
    const form = document.getElementById("uploadForm");
    const versionInput = document.getElementById("versionInput");

    dropZone.addEventListener("click", () => fileInput.click());

    ["dragenter", "dragover"].forEach(ev => {
      dropZone.addEventListener(ev, e => {
        e.preventDefault(); e.stopPropagation();
        dropZone.classList.add("hover");
        uploadText.textContent = "DÃ©pose ton fichier ZIP ici...";
      });
    });

    ["dragleave", "drop"].forEach(ev => {
      dropZone.addEventListener(ev, e => {
        e.preventDefault(); e.stopPropagation();
        dropZone.classList.remove("hover");
        uploadText.textContent = "Glisse ton fichier .zip ici ou clique pour le choisir";
      });
    });

    dropZone.addEventListener("drop", e => {
      const file = e.dataTransfer.files[0];
      if (!file || !file.name.endsWith(".zip")) {
        uploadText.textContent = "âŒ Format invalide. ZIP requis.";
        return;
      }
      fileInput.files = e.dataTransfer.files;
      uploadText.textContent = `âœ… Fichier sÃ©lectionnÃ© : ${file.name}`;
    });

    fileInput.addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) uploadText.textContent = `âœ… Fichier sÃ©lectionnÃ© : ${file.name}`;
    });

    form.addEventListener("submit", e => {
      if (!fileInput.files.length) {
        e.preventDefault();
        uploadText.textContent = "âŒ Merci de sÃ©lectionner un fichier ZIP.";
      } else if (!versionInput.value.trim()) {
        e.preventDefault();
        uploadText.textContent = "âŒ Merci dâ€™indiquer une version.";
      }
    });
  </script>
</body>
</html>
