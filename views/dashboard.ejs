<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Bot Updates</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #0f1124, #17192e);
      color: white;
      margin: 0;
    }
    header {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    .card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .btn {
      padding: 8px 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }
    .btn-primary {
      background: #5865f2;
      color: white;
    }
    .btn-primary:hover {
      background: #4752c4;
    }
    input, .dropzone {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 10px;
      color: white;
      width: 100%;
      box-sizing: border-box;
    }
    .dropzone {
      text-align: center;
      border: 2px dashed rgba(255,255,255,0.2);
      transition: 0.3s;
      padding: 40px 10px;
    }
    .dropzone.dragover {
      border-color: #5865f2;
      background: rgba(88,101,242,0.1);
    }
    .progress {
      height: 8px;
      width: 100%;
      background: rgba(255,255,255,0.1);
      border-radius: 5px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-bar {
      height: 100%;
      width: 0;
      background: #5865f2;
      transition: 0.3s;
    }
  </style>
</head>
<body>
  <header>
    <h1>Dashboard Admin</h1>
    <a href="/logout" class="btn btn-primary">Se dÃ©connecter</a>
  </header>

  <div class="container">
    <% if (!isOwner) { %>
      <div class="card" style="text-align:center;">
        <h2>ðŸš« AccÃ¨s refusÃ©</h2>
        <p>Vous nâ€™Ãªtes pas autorisÃ© Ã  voir cette page.</p>
      </div>
    <% } else { %>
      <div class="card">
        <h2>Statistiques</h2>
        <canvas id="chart" height="120"></canvas>
      </div>

      <div class="card">
        <h2>Uploader une version</h2>
        <form id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data">
          <input type="text" name="version" placeholder="Version (ex: v2.3)" required />
          <div id="dropzone" class="dropzone">Glissez votre .zip ici ou cliquez pour sÃ©lectionner</div>
          <input id="fileInput" name="updateZip" type="file" accept=".zip" style="display:none;">
          <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
          <button class="btn btn-primary" type="submit" style="margin-top:10px;">Uploader</button>
        </form>
      </div>
    <% } %>
  </div>

  <script>
    const labels = JSON.parse('<%- chartLabels %>');
    const values = JSON.parse('<%- chartValues %>');

    new Chart(document.getElementById("chart"), {
      type: "bar",
      data: { labels, datasets: [{ label: "Mises Ã  jour par jour", data: values, backgroundColor: "#5865f2" }] },
      options: { scales: { y: { beginAtZero: true } } }
    });

    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");
    const progressBar = document.getElementById("progressBar");

    dropzone.addEventListener("click", () => fileInput.click());
    dropzone.addEventListener("dragover", e => { e.preventDefault(); dropzone.classList.add("dragover"); });
    dropzone.addEventListener("dragleave", () => dropzone.classList.remove("dragover"));
    dropzone.addEventListener("drop", e => {
      e.preventDefault(); dropzone.classList.remove("dragover");
      fileInput.files = e.dataTransfer.files;
      dropzone.textContent = e.dataTransfer.files[0].name;
    });

    const form = document.getElementById("uploadForm");
    form.addEventListener("submit", async e => {
      e.preventDefault();
      const data = new FormData(form);
      const req = new XMLHttpRequest();
      req.open("POST", "/upload");
      req.upload.onprogress = e => {
        if (e.lengthComputable) {
          progressBar.style.width = `${(e.loaded / e.total) * 100}%`;
        }
      };
      req.onload = () => window.location.reload();
      req.send(data);
    });
  </script>
</body>
</html>
