<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Gestion des bots ‚Ä¢ HOME UPDATE</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
  <style>
    .bot-card {
      border: 1px solid #444;
      background: #1b1b1b;
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 10px;
      transition: 0.2s;
    }
    .bot-card:hover { background: #222; }
    .bot-details { display: none; padding: 8px 0 0 0; border-top: 1px solid #333; margin-top: 6px; }
    .bot-card.open .bot-details { display: block; }
    .bot-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
    .bot-actions button { margin-left: 6px; }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="brand">
      <img src="/logo.png" alt="HOME UPDATE" class="nav-logo" />
      <span class="brand-text">HOME UPDATE</span>
    </div>
    <div class="nav-right">
      <a class="btn" href="/dashboard">Dashboard</a>
      <a class="btn" href="/">Accueil</a>
      <a class="btn danger" href="/logout">D√©connexion</a>
    </div>
  </nav>

  <main class="container">
    <header class="hero">
      <h1>ü§ñ Gestion des Bots</h1>
      <p>Liste compl√®te des bots enregistr√©s.</p>
    </header>

    <section>
      <% if (bots.length === 0) { %>
        <p class="muted">Aucun bot enregistr√©.</p>
      <% } else { %>
        <% bots.forEach(bot => { %>
          <div class="bot-card" data-id="<%= bot._id %>">
            <div class="bot-header">
              <strong><%= bot.name %></strong>
              <div class="bot-actions">
                <button class="btn small decrypt-btn" data-id="<%= bot._id %>">üîê Voir Token</button>
                <form action="/owner/bots/<%= bot._id %>/delete" method="POST" style="display:inline;">
                  <button type="submit" class="btn danger small">üóëÔ∏è Supprimer</button>
                </form>
              </div>
            </div>
            <div class="bot-details">
              <p><strong>Propri√©taire :</strong> <%= bot.ownerId %></p>
              <p><strong>Ajout√© le :</strong> <%= new Date(bot.createdAt).toLocaleString("fr-FR") %></p>
              <p><strong>Dernier READY :</strong> <%= bot.stats?.lastReady ? new Date(bot.stats.lastReady).toLocaleString("fr-FR") : "Jamais" %></p>
              <p><strong>Red√©marrages :</strong> <%= bot.stats?.restarts || 0 %></p>
              <p><strong>Erreurs :</strong> <%= bot.stats?.errors || 0 %></p>
              <% if (bot.meta?.notes) { %>
                <p><strong>Notes :</strong> <%= bot.meta.notes %></p>
              <% } %>
            </div>
          </div>
        <% }) %>
      <% } %>
    </section>
  </main>

  <footer class="footer">
    ¬© <%= new Date().getFullYear() %> ‚Äî HOME UPDATE Panel ¬∑
    <a href="<%= support %>" target="_blank" rel="noopener">Discord</a>
  </footer>

  <script>
    document.querySelectorAll('.bot-header').forEach(h => {
      h.addEventListener('click', () => {
        h.parentElement.classList.toggle('open');
      });
    });

    document.querySelectorAll('.decrypt-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        e.stopPropagation();
        const id = btn.dataset.id;
        const res = await fetch(`/owner/bots/${id}/decrypt`);
        const data = await res.json();
        alert(`Token de ${data.name} :\n\n${data.token}`);
      });
    });
  </script>
</body>
</html>
