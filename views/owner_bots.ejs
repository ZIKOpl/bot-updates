<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Gestion des Bots â€” Dashboard</title>
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="bg-gray-900 text-white font-sans">
    <div class="container mx-auto py-10 px-4">
      <h1 class="text-3xl font-bold mb-6">ðŸ‘‘ Gestion des Bots</h1>

      <form action="/owner/bots/add" method="POST" class="mb-8 bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl mb-3">âž• Ajouter un Bot</h2>
        <input name="name" placeholder="Nom du bot" required class="input mb-2 w-full" />
        <input name="tokenPlain" placeholder="Token du bot" required class="input mb-2 w-full" />
        <textarea name="notes" placeholder="Notes (facultatif)" class="input mb-2 w-full"></textarea>
        <button type="submit" class="btn bg-green-600 hover:bg-green-700">Ajouter</button>
      </form>

      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="border-b border-gray-700">
            <th class="p-2">Nom</th>
            <th class="p-2">Dernier Ready</th>
            <th class="p-2">Dernier Check</th>
            <th class="p-2">RedÃ©marrages</th>
            <th class="p-2">Erreurs</th>
          </tr>
        </thead>
        <tbody>
          <% bots.forEach(bot => { %>
            <tr class="border-b border-gray-800">
              <td class="p-2 font-semibold"><%= bot.name %></td>
              <td class="p-2"><%= bot.stats.lastReady ? new Date(bot.stats.lastReady).toLocaleString("fr-FR") : "Jamais" %></td>
              <td class="p-2"><%= bot.stats.lastCheck ? new Date(bot.stats.lastCheck).toLocaleString("fr-FR") : "Jamais" %></td>
              <td class="p-2 text-yellow-400"><%= bot.stats.restarts %></td>
              <td class="p-2 text-red-400"><%= bot.stats.errors %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <canvas id="chart" width="400" height="150" class="mt-8"></canvas>
    </div>

    <script>
      const ctx = document.getElementById("chart");
      const data = {
        labels: <%- JSON.stringify(bots.map(b => b.name)) %>,
        datasets: [
          {
            label: "RedÃ©marrages",
            data: <%- JSON.stringify(bots.map(b => b.stats.restarts)) %>,
            backgroundColor: "rgba(75, 192, 192, 0.6)",
          },
          {
            label: "Erreurs",
            data: <%- JSON.stringify(bots.map(b => b.stats.errors)) %>,
            backgroundColor: "rgba(255, 99, 132, 0.6)",
          }
        ]
      };

      new Chart(ctx, {
        type: "bar",
        data,
        options: {
          scales: { y: { beginAtZero: true } },
          plugins: { legend: { labels: { color: "white" } } },
        }
      });
    </script>

    <style>
      body { font-family: "Inter", sans-serif; }
      .input {
        background: #1f2937;
        color: white;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #374151;
      }
      .btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: bold;
      }
    </style>
  </body>
</html>
